import{r as _,j as q,o as z,L as $,f as H,t as w,v as x,x as i,M as I,N as M,y as J,O as E,G as j,z as F,P,Q as U,R as G}from"./CisGqN2-.js";import{s as A,a as T}from"./C6FQmxNJ.js";const V={class:"flex flex-wrap justify-between px-8 py-4 mb-8 overflow-y-auto"},K={class:"w-full mb-8 lg:w-1/2"},W=i("h3",{class:"mb-2 text-lg font-semibold"},"Active HTTP Server Requests",-1),Q=i("p",{class:"mb-2 text-sm text-gray-600"},"Displays the number of active HTTP server requests over time, provides insights into server load and traffic patterns.",-1),X={class:"mb-2 text-lg font-semibold"},Y={class:"mb-2 text-sm text-gray-600"},Z=["id"],ee={__name:"Metrices",setup(B){const{BaseChart:g}=A,m=_(null),c=_(null),h=_(null),D=_(null),u=_([]),C=[c,h,D];let k=null;const L=async()=>{try{const r={keyword:""};return await T.fetchTelemetryMetrics(r)}catch(r){return console.log(r),[]}},N=q(()=>["HTTP Request Duration","HTTP Response Size","HTTP Request Size"]),O=r=>r.includes("Duration")?"Shows the distribution of request processing times. Data is grouped into time ranges (in milliseconds).":r.includes("Response Size")?"Illustrates the distribution of response data volumes. Data is grouped into size ranges (in bytes).":r.includes("Request Size")?"Displays the distribution of incoming data volumes. Data is grouped into size ranges (in bytes).":"Data is grouped into ranges to show the overall distribution.";function R(r){const p=r[0].histogram.explicitBounds;return r.map(f=>{const l=f.histogram.bucketCounts.map(Number);return p.map((d,o)=>{const n=p[o+1]||1/0;return[d,n,l[o]]})})}function S(r,p,f,l){var v;const o=l.map((e,t)=>({data:e,totalCount:e.reduce((a,s)=>a+s[2],0),index:t})).sort((e,t)=>t.totalCount-e.totalCount).slice(0,10).map(e=>{const t=[0,0,0,0,0];return e.data.forEach(a=>{const s=a[0],b=a[2];s<10?t[0]+=b:s<100?t[1]+=b:s<1e3?t[2]+=b:s<1e4?t[3]+=b:t[4]+=b}),t}),n=Math.max(...o.flat()),y={container:(v=r[0])==null?void 0:v.id,tooltip:{trigger:"item",formatter:function(e){return`${e.seriesName}<br/>${e.name}: ${e.value}`}},xAxis:{name:f,type:"category",data:["0-9","10-99","100-999","1000-9999","10000+"],axisLabel:{rotate:45,interval:0,fontSize:10}},yAxis:{name:"Frequency",type:"value",max:n*1.1},series:o.slice(0,5).map((e,t)=>({name:`Dataset ${t+1}`,type:"bar",data:e,stack:"total",barWidth:"50%"})),grid:{left:"10%",right:"10%",bottom:"20%",top:"10%",containLabel:!1},legend:{type:"scroll",orient:"horizontal",bottom:0,formatter:e=>e.replace("Dataset ","")}};return new g(y)}return z(()=>{$(async()=>{const r=await L(),p=Object.keys(r).find(d=>{var o,n;return(n=(o=r[d])==null?void 0:o.data_points[0])==null?void 0:n.sum}),f=Object.keys(r).filter(d=>{var o,n;return(n=(o=r[d])==null?void 0:o.data_points[0])==null?void 0:n.histogram}),l=r[p];if(m.value){const d=l.data_points.map(y=>new Date(parseInt(y.sum.timeUnixNano)/1e6).toLocaleTimeString()),o=l.data_points.map(y=>parseInt(y.sum.asInt)),n={container:m.value.id,tooltip:{trigger:"axis"},xAxis:{type:"category",data:d,axisLabel:{rotate:45,interval:"auto"}},yAxis:{type:"value",name:"Requests",min:0,max:Math.max(...o)+1},series:[{name:"Requests",type:"line",data:o,smooth:!0}]};k=new g(n)}if(c.value){let o=function(n){const y=[c,h,D];u.value=n.map((v,e)=>{const t=R(v.data_points);return S(y[e].value,v.description,v.unit,t)})};const d=f.map(n=>({...r[n]}));o(d)}})}),H(()=>{k==null||k.destroy()}),(r,p)=>(w(),x("div",V,[i("div",K,[W,Q,i("div",{id:"lineChart",ref_key:"lineChartRef",ref:m,class:"h-80"},null,512)]),(w(),x(I,null,M(C,(f,l)=>i("div",{key:l,class:"w-full mb-8 lg:w-1/2"},[i("h3",X,J(E(N)[l]),1),i("p",Y,J(O(E(N)[l])),1),i("div",{id:`histogramChart-container-${l}`,ref_for:!0,ref:f,class:"h-80"},null,8,Z)])),64))]))}},te={class:"flex flex-col w-full p-5 m-4 overflow-y-hidden border-2 border-gray-200 border-solid rounded-lg box-shadow-md"},se=i("h1",{class:"px-4 my-4 mb-4 text-4xl font-bold"},"Telemetry",-1),ae={class:"flex items-center justify-between mx-4 border-b border-gray-200 border-solid"},re={class:"flex border-b"},oe=["onClick"],ne=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none"},[i("path",{stroke:"#3b82f6","stroke-linecap":"round","stroke-linejoin":"round",d:"M4.99 6.232h-3v-3"}),i("path",{stroke:"#3b82f6","stroke-linecap":"round","stroke-linejoin":"round",d:"M4.11 11.889a5.5 5.5 0 1 0 0-7.778L1.99 6.232"})],-1),ie=[ne],le={class:"flex-grow overflow-y-auto"},ce={key:0,id:"logs-table",class:"w-full"},ue={key:1,class:"w-full px-4",id:"traces-table"},de={key:2,class:"w-full px-4",id:"events-table"},me={key:3,class:"w-full px-4"},ye={__name:"telemetry",setup(B){const{Table:g}=A;U();const m=_([]),c=_([]),h=_([]),D=["Logs","Traces","Events","Metrics"],u=_("Logs"),C=[{key:"trace_id",header:"Trace ID"},{key:"start_time",header:"Start Time",formatter:e=>new Date(e).toLocaleString()},{key:"end_time",header:"End Time",formatter:e=>new Date(e).toLocaleString()},{key:"name",header:"Name"},{key:"span_id",header:"Span ID"}],k=[{key:"name",header:"Name"},{key:"event_type",header:"Event Type"},{key:"status",header:"Status"},{key:"application_name",header:"Application Name"},{key:"attributes",header:"Attributes"},{key:"timestamp",header:"Timestamp"},{key:"observed_timestamp",header:"Observed Timestamp"}],L=e=>{u.value=e,e==="Logs"?S():e==="Traces"?r():e==="Events"&&O()},N=()=>{u.value==="Logs"?S():u.value==="Traces"?r():u.value==="Events"&&O()},O=async()=>{await R(),new g("events-table",{columns:k,data:JSON.parse(JSON.stringify(h.value)),options:{scrollable:!0,searchable:!0,pageSize:20,onChange:e=>y(e)}})},R=async()=>{try{const e={keyword:""},t=await T.fetchTelemetryEvents(e);return t&&t.length?h.value=t:h.value=[],h.value}catch(e){return console.log(e),[]}},S=async()=>{await f(),new g("logs-table",{columns:p,data:JSON.parse(JSON.stringify(m.value)),options:{scrollable:!0,searchable:!0,pageSize:20,onChange:e=>o(e)}})},r=async()=>{await d(),new g("traces-table",{columns:C,data:JSON.parse(JSON.stringify(c.value)),options:{scrollable:!0,searchable:!0,pageSize:20,expandable:!0,onChange:e=>n(e)}})},p=[{key:"severity",header:"Severity",formatter:e=>`
            <div class="flex items-center">
                <span class="${v[e]||"text-gray-600"} text-base"> ${e} </span>
            </div>
        `},{key:"observed_timestamp",header:"Timestamp",formatter:e=>new Date(e).toLocaleString()},{key:"body",header:"Body"},{key:"trace_id",header:"Trace ID"},{key:"span_id",header:"Span ID"}],f=async()=>{try{const e={keyword:""},t=await T.fetchTelemetryLogs(e);return t&&t.length?m.value=t:m.value=[],m.value}catch(e){return console.log(e),[]}},l=e=>{const t=e.reduce((a,s)=>(a[s.trace_id]||(a[s.trace_id]={trace_id:s.trace_id,spans:[],start_time:new Date(s.start_time).toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}),end_time:new Date(s.end_time).toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}),name:s.name,span_id:s.span_id}),a[s.trace_id].spans.push(s),a[s.trace_id].start_time=new Date(Math.min(new Date(a[s.trace_id].start_time),new Date(s.start_time))),a[s.trace_id].end_time=new Date(Math.max(new Date(a[s.trace_id].end_time),new Date(s.end_time))),a),{});return Object.values(t).sort((a,s)=>new Date(s.start_time)-new Date(a.start_time))},d=async()=>{try{const e={keyword:""},t=await T.fetchTelemetryTraces(e);return t&&t.length?(c.value=l(t),console.log(c.value,"<-- tracesData.value")):c.value=[],c.value}catch(e){return console.log(e),[]}},o=async({key:e,value:t})=>{const a={keyword:t};switch(e){case"search":const s=await T.fetchTelemetryLogs(a);console.log(s,"<---- search response"),m.value=s||[]}return new g("logs-table",{columns:p,data:JSON.parse(JSON.stringify(m.value)),options:{scrollable:!0,searchable:!0,pageSize:20,onChange:s=>o(s)}}),JSON.parse(JSON.stringify(m.value))},n=async({key:e,value:t})=>{const a={keyword:t},s=await T.fetchTelemetryTraces(a);return c.value=s||[],new g("traces-table",{columns:C,data:JSON.parse(JSON.stringify(c.value)),options:{scrollable:!0,searchable:!0,pageSize:20,expandable:!0,onChange:b=>n(b)}}),JSON.parse(JSON.stringify(c.value))},y=async({key:e,value:t})=>{const a={keyword:t||""},s=await T.fetchTelemetryEvents(a);return h.value=s||[],new g("events-table",{columns:k,data:JSON.parse(JSON.stringify(h.value)),options:{scrollable:!0,searchable:!0,pageSize:20,expandable:!0,onChange:b=>y(b)}}),JSON.parse(JSON.stringify(h.value))};z(()=>{$(async()=>{await S()})}),j(u,e=>{e==="Logs"&&S(),e==="Traces"&&r()});const v={DEBUG:"text-gray-600",INFO:"text-blue-500",WARNING:"text-yellow-500",ERROR:"text-red-400",CRITICAL:"text-red-500"};return(e,t)=>(w(),x("div",te,[se,i("div",ae,[i("ul",re,[(w(),x(I,null,M(D,a=>i("li",{class:"mr-1",key:a},[i("a",{class:G(["inline-block py-2 px-4 text-lg font-medium cursor-pointer transition-all duration-300 ease-in-out",u.value===a?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 border-b-2 border-transparent"]),onClick:()=>L(a)},J(a),11,oe)])),64))]),i("button",{onClick:N,class:"p-2 ml-4 text-white transition-colors bg-white border border-solid rounded-md border-slate-400 hover:bg-white hover:border-blue-500 hover:shadow-md"},ie)]),i("div",le,[u.value==="Logs"?(w(),x("div",ce)):u.value==="Traces"?(w(),x("div",ue)):u.value==="Events"?(w(),x("div",de)):u.value==="Metrics"?(w(),x("div",me,[F(E(ee))])):P("",!0)])]))}};export{ye as default};
