var j=Object.defineProperty;var B=(c,a,s)=>a in c?j(c,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[a]=s;var J=(c,a,s)=>B(c,typeof a!="symbol"?a+"":a,s);import{r as b,j as P,o as z,S as H,f as F,t as _,v,x as l,L as A,M,y as q,T as I,U as G,G as V,z as W,Q as K,R as Q}from"./DcT2Ma-o.js";import{s as U}from"./Duu6Y5w9.js";import"./DWyYeOWN.js";class X{constructor(){J(this,"baseUrl");J(this,"defaultHeaders");this.baseUrl=(window==null?void 0:window.location.origin)||"http://0.0.0.0:8000",this.defaultHeaders={"Content-Type":"application/json"}}async request(a,s){const o=`${this.baseUrl}${a}`,f={...this.defaultHeaders,...s.headers},m={...s,headers:f};try{const h=await fetch(o,m);if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const w=h.headers.get("content-type");return w&&w.includes("application/json")?await h.json():await h.text()}catch(h){throw console.error("API request failed:",h),h}}async get(a,s={}){const o=new URL(`${this.baseUrl}${a}`);return Object.keys(s).forEach(f=>o.searchParams.append(f,s[f])),this.request(o.pathname+o.search,{method:"GET"})}async post(a,s){return this.request(a,{method:"POST",body:JSON.stringify(s)})}async put(a,s){return this.request(a,{method:"PUT",body:JSON.stringify(s)})}async delete(a){return this.request(a,{method:"DELETE"})}}const R={preflight:"/workflows/preflight-check",testAuthentication:"/workflows/test-authentication",login:"/login",logout:"/logout",runWorkflow:"/workflows/start-workflow",events:"/events",telemetry:{logs:"/telemetry/v1/logs",metrics:"/telemetry/v1/metrics",traces:"/telemetry/v1/traces"}},L=new X,C={preflight:async c=>(await L.post(R.preflight,c)).json(),fetchTelemetryLogs:async c=>{const{keyword:a,limit:s=100}=c;return await L.get(`${R.telemetry.logs}?skip=0&limit=${s}&keyword=${a}`)},fetchTelemetryTraces:async c=>{const{keyword:a,limit:s=100}=c;return await L.get(`${R.telemetry.traces}?skip=0&limit=${s}`)},fetchTelemetryMetrics:async c=>{const{keyword:a,limit:s=100}=c;return await L.get(`${R.telemetry.metrics}?skip=0&limit=${s}`)}},Y={class:"flex flex-wrap justify-between px-8 py-4 mb-8"},Z={class:"w-full mb-8 lg:w-1/2"},ee=l("h3",{class:"mb-2 text-lg font-semibold"},"Active HTTP Server Requests",-1),te=l("p",{class:"mb-2 text-sm text-gray-600"},"Displays the number of active HTTP server requests over time, provides insights into server load and traffic patterns.",-1),se={class:"mb-2 text-lg font-semibold"},ae={class:"mb-2 text-sm text-gray-600"},re=["id"],ne={__name:"Metrices",setup(c){const{BaseChart:a}=U,s=b(null),o=b(null),f=b(null),m=b(null),h=b([]),w=[o,f,m];let x=null;const O=async()=>{try{const i={keyword:""},y=await C.fetchTelemetryMetrics(i);return console.log(y,"<-- response"),y}catch(i){return console.log(i),[]}},k=P(()=>["HTTP Request Duration","HTTP Response Size","HTTP Request Size"]),$=i=>i.includes("Duration")?"Shows the distribution of request processing times. Data is grouped into time ranges (in milliseconds).":i.includes("Response Size")?"Illustrates the distribution of response data volumes. Data is grouped into size ranges (in bytes).":i.includes("Request Size")?"Displays the distribution of incoming data volumes. Data is grouped into size ranges (in bytes).":"Data is grouped into ranges to show the overall distribution.";function N(i){const y=i[0].histogram.explicitBounds;return i.map(g=>{const d=g.histogram.bucketCounts.map(Number);return y.map((p,e)=>{const r=y[e+1]||1/0;return[p,r,d[e]]})})}function E(i,y,g,d){const e=d.map((t,u)=>({data:t,totalCount:t.reduce((T,D)=>T+D[2],0),index:u})).sort((t,u)=>u.totalCount-t.totalCount).slice(0,10).map(t=>{const u=[0,0,0,0,0];return t.data.forEach(T=>{const D=T[0],S=T[2];D<10?u[0]+=S:D<100?u[1]+=S:D<1e3?u[2]+=S:D<1e4?u[3]+=S:u[4]+=S}),u}),r=Math.max(...e.flat()),n={container:i.id,tooltip:{trigger:"item",formatter:function(t){return`${t.seriesName}<br/>${t.name}: ${t.value}`}},xAxis:{name:g,type:"category",data:["0-9","10-99","100-999","1000-9999","10000+"],axisLabel:{rotate:45,interval:0,fontSize:10}},yAxis:{name:"Frequency",type:"value",max:r*1.1},series:e.slice(0,5).map((t,u)=>({name:`Dataset ${u+1}`,type:"bar",data:t,stack:"total",barWidth:"50%"})),grid:{left:"10%",right:"10%",bottom:"20%",top:"10%",containLabel:!1},legend:{type:"scroll",orient:"horizontal",bottom:0,formatter:t=>t.replace("Dataset ","")}};return new a(n)}return z(()=>{H(async()=>{const i=await O(),y=Object.keys(i).find(p=>{var e,r;return(r=(e=i[p])==null?void 0:e.data_points[0])==null?void 0:r.sum}),g=Object.keys(i).filter(p=>{var e,r;return(r=(e=i[p])==null?void 0:e.data_points[0])==null?void 0:r.histogram}),d=i[y];if(s.value){const p=d.data_points.map(n=>new Date(parseInt(n.sum.timeUnixNano)/1e6).toLocaleTimeString()),e=d.data_points.map(n=>parseInt(n.sum.asInt)),r={container:s.value.id,tooltip:{trigger:"axis"},xAxis:{type:"category",data:p,axisLabel:{rotate:45,interval:"auto"}},yAxis:{type:"value",name:"Requests",min:0,max:Math.max(...e)+1},series:[{name:"Requests",type:"line",data:e,smooth:!0}]};x=new a(r)}if(o.value){let e=function(r){const n=[o,f,m];h.value=r.map((t,u)=>{const T=N(t.data_points);return E(n[u].value,t.description,t.unit,T)})};const p=g.map(r=>({...i[r]}));e(p)}})}),F(()=>{x==null||x.destroy()}),(i,y)=>(_(),v("div",Y,[l("div",Z,[ee,te,l("div",{id:"lineChart",ref_key:"lineChartRef",ref:s,class:"h-80"},null,512)]),(_(),v(A,null,M(w,(g,d)=>l("div",{key:d,class:"w-full mb-8 lg:w-1/2"},[l("h3",se,q(I(k)[d]),1),l("p",ae,q($(I(k)[d])),1),l("div",{id:`histogramChart-container-${d}`,ref_for:!0,ref:g,class:"h-80"},null,8,re)])),64)),l("div",{id:"histogramChart-container-0",ref_key:"histogramChartRef0",ref:o,style:{width:"600px",height:"400px"},class:"mb-8"},null,512),l("div",{id:"histogramChart-container-1",ref_key:"histogramChartRef1",ref:f,style:{width:"600px",height:"400px"},class:"mb-8"},null,512),l("div",{id:"histogramChart-container-2",ref_key:"histogramChartRef2",ref:m,style:{width:"600px",height:"400px"},class:"mb-8"},null,512)]))}},oe={class:"flex flex-col w-full p-5 m-4 overflow-y-hidden border-2 border-gray-200 border-solid rounded-lg box-shadow-md"},ie=l("h1",{class:"px-4 my-4 mb-4 text-4xl font-bold"},"Telemetry",-1),le={class:"px-4"},ce={class:"flex border-b"},ue=["onClick"],de={class:"flex-grow"},me={key:0,id:"logs-table",class:"w-full px-4"},he={key:1,class:"w-full px-4",id:"traces-table"},pe={key:2,class:"w-full px-4",id:"events-table"},ye={key:3,class:"w-full px-4"},be={__name:"telemetry",setup(c){const{Table:a}=U;G();const s=b([]),o=b([]),f=["Logs","Traces","Metrics","Events"],m=b("Logs"),h=[{key:"trace_id",header:"Trace ID"},{key:"start_time",header:"Start Time",formatter:e=>new Date(e).toLocaleString()},{key:"end_time",header:"End Time",formatter:e=>new Date(e).toLocaleString()},{key:"name",header:"Name"},{key:"span_id",header:"Span ID"}],w=[{key:"name",header:"Name"},{key:"event_type",header:"Event Type"},{key:"status",header:"Status"},{key:"application_name",header:"Application Name"},{key:"attributes",header:"Attributes"},{key:"timestamp",header:"Timestamp"},{key:"observed_timestamp",header:"Observed Timestamp"}],x=e=>{m.value=e,e==="Logs"?k():e==="Traces"?$():e==="Events"&&O()},O=async()=>{new a("events-table",{columns:w,data:JSON.parse(JSON.stringify(eventsData.value))})},k=async()=>{await E(),new a("logs-table",{columns:N,data:JSON.parse(JSON.stringify(s.value)),options:{scrollable:!0,searchable:!0,pageSize:20,onChange:e=>g(e)}})},$=async()=>{await y(),new a("traces-table",{columns:h,data:JSON.parse(JSON.stringify(o.value)),options:{scrollable:!0,searchable:!0,pageSize:20,expandable:!0,onChange:e=>d(e)}})},N=[{key:"severity",header:"Severity",formatter:e=>`
            <div class="flex items-center">
                <span class="${p[e]||"text-gray-600"} text-base"> ${e} </span>
            </div>
        `},{key:"observed_timestamp",header:"Timestamp",formatter:e=>new Date(e).toLocaleString()},{key:"body",header:"Body"},{key:"trace_id",header:"Trace ID"},{key:"span_id",header:"Span ID"}],E=async()=>{try{const e={keyword:""},r=await C.fetchTelemetryLogs(e);return r&&r.length?s.value=r:s.value=[],s.value}catch(e){return console.log(e),[]}},i=e=>{const r=e.reduce((n,t)=>(n[t.trace_id]||(n[t.trace_id]={trace_id:t.trace_id,spans:[],start_time:new Date(t.start_time).toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}),end_time:new Date(t.end_time).toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}),name:t.name,span_id:t.span_id}),n[t.trace_id].spans.push(t),n[t.trace_id].start_time=new Date(Math.min(new Date(n[t.trace_id].start_time),new Date(t.start_time))),n[t.trace_id].end_time=new Date(Math.max(new Date(n[t.trace_id].end_time),new Date(t.end_time))),n),{});return Object.values(r).sort((n,t)=>new Date(t.start_time)-new Date(n.start_time))},y=async()=>{try{const e={keyword:""},r=await C.fetchTelemetryTraces(e);return r&&r.length?(o.value=i(r),console.log(o.value,"<-- tracesData.value")):o.value=[],o.value}catch(e){return console.log(e),[]}},g=async({key:e,value:r})=>{const n={keyword:r};switch(e){case"search":const t=await C.fetchTelemetryLogs(n);console.log(t,"<---- search response"),s.value=t||[]}return new a("logs-table",{columns:N,data:JSON.parse(JSON.stringify(s.value)),options:{scrollable:!0,searchable:!0,pageSize:20,onChange:t=>g(t)}}),JSON.parse(JSON.stringify(s.value))},d=async({key:e,value:r})=>{const n={keyword:r},t=await C.fetchTelemetryTraces(n);return o.value=t||[],new a("traces-table",{columns:h,data:JSON.parse(JSON.stringify(o.value)),options:{scrollable:!0,searchable:!0,pageSize:20,expandable:!0,onChange:u=>d(u)}}),JSON.parse(JSON.stringify(o.value))};z(()=>{H(async()=>{await k()})}),V(m,e=>{e==="Logs"&&k(),e==="Traces"&&$()});const p={DEBUG:"text-gray-600",INFO:"text-blue-500",WARNING:"text-yellow-500",ERROR:"text-red-400",CRITICAL:"text-red-500"};return(e,r)=>(_(),v("div",oe,[ie,l("div",le,[l("ul",ce,[(_(),v(A,null,M(f,n=>l("li",{class:"mr-1",key:n},[l("a",{class:Q(["inline-block py-2 px-4 text-base font-medium cursor-pointer transition-all duration-300 ease-in-out",m.value===n?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 border-b-2 border-transparent"]),onClick:()=>x(n)},q(n),11,ue)])),64))])]),l("div",de,[m.value==="Logs"?(_(),v("div",me)):m.value==="Traces"?(_(),v("div",he)):m.value==="Events"?(_(),v("div",pe)):m.value==="Metrics"?(_(),v("div",ye,[W(I(ne))])):K("",!0)])]))}};export{be as default};
